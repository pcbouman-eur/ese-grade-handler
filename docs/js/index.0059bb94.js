(function(e){function t(t){for(var a,o,i=t[0],l=t[1],u=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);c&&c(t);while(f.length)f.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,i=1;i<n.length;i++){var l=n[i];0!==r[l]&&(a=!1)}a&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={index:0},s=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/ese-grade-handler/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var c=l;s.push([1,"chunk-vendors"]),n()})({0:function(e,t){},"0a80":function(e,t,n){},"0b00":function(e,t,n){"use strict";n("e621")},"0b9b":function(e,t,n){"use strict";n("0bcb")},"0bcb":function(e,t,n){},1:function(e,t,n){e.exports=n("56d7")},1387:function(e,t,n){},2:function(e,t){},"2b92":function(e,t,n){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:""}},[n("div",{staticClass:"d-flex align-center"},[n("h3",[e._v("ESE Grade Handler")])]),n("v-spacer"),n("v-btn",{attrs:{color:"error"},on:{click:e.refresh}},[e._v("Reset")])],1),n("v-main",[n("v-tabs",{attrs:{centered:""},model:{value:e.currentTab,callback:function(t){e.currentTab=t},expression:"currentTab"}},[n("v-tab",[e._v("Welcome")]),n("v-tab",[e._v("Combiner")]),n("v-tab",[e._v("Injector")]),n("v-tab",[e._v("Mutator")])],1),0==e.currentTab?n("Welcome"):1==e.currentTab?n("Combiner"):2==e.currentTab?n("Injector"):3==e.currentTab?n("Mutator"):e._e()],1)],1)},s=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("h2",[e._v("ESE Grade Handler")]),n("h3",[e._v("Introduction")]),n("p",[e._v('This is a tool that attempts to simplify a number of tasks that involve grades from students. Currently, there are two tasks it can help with: (1) combining student results from a number of different spreadsheet files or different sheets (tabs) within a file into a single table, and (2) injecting final course results into the official SPD spreadsheet format required to submit official grades. You can pick a tool you want to use at the top of the page, by clicking "Combiner" or "Injector". ')]),n("h3",[e._v("How does it work")]),n("p",[e._v("For this tool to be able to use your spreadsheet files, they must have a certain structure. Sheets or Tabs that do not have this structure will be ignored.")]),n("ul",{staticStyle:{"margin-bottom":"1em"}},[n("li",[e._v("A sheet with results must have a table that starts in cell "),n("code",[e._v("A1")]),e._v(" with a header in row "),n("code",[e._v("A")]),e._v(" (the first row) and data starting at row "),n("code",[e._v("B")]),e._v(" (the second row). Sheets with two header rows, for example as they are exported by Canvas, are not supported; you are advised to just delete additional header rows before you use a spreadsheet in this tool.")]),n("li",[e._v("At least one of the columns in a sheet must be a "),n("em",[e._v("key-column")]),e._v(" with student identities. A student identity is any piece of text that contains a single erna identity (e.g. "),n("code",[e._v("123456ab")]),e._v(") somewhere. ")]),n("li",[e._v("A key column must hold a student identity in every row of the data, and every identity with a column must be unique: if the same student identity occurs twice within a key column, the column is not accepted as a key column. ")]),n("li",[e._v("If there are multiple key columns, one of them is picked arbitrarily. If there are different key columns that have conflicting student identities, you may get unexpected results. It is thus advised to only have a single column with student identities. Currently, there is no check in place to warn you against these types of scenarios, although this may be added in the future. ")])]),n("h3",[e._v("Attendance Data (new)")]),n("p",[e._v("Attendance data, exported verbatim from sin-online as "),n("code",[e._v("xls")]),e._v(" file, is now also supported. If you import attendance data, double entries are automatically merged (i.e. if students switched between session) and a 70% threshold is used to determine attendance. This threshold can be adjusted. Attendance data is supported both for the combiner, where you can add attendance columns to your output, and the injector, where it injects GGR when this is appropiate.")]),n("h3",[e._v("Is this safe?")]),n("p",[e._v("All processing of grades happens solely within your web-browser, and no data is transmitted over the internet by this tool. Once this website is loaded in your browser, you can disconnect from the internet to handle your grades offline. If you don't believe this, you can easily check this with the network activity inspector in your browser's developer tools, or by inspecting the "),n("a",{attrs:{href:"https://github.com/pcbouman-eur/ese-grade-handler",target:"blank"}},[e._v("source code of this application")]),e._v(".")]),n("h3",[e._v("I need feature X or feature Y is not working for me, can you do something about it?")]),n("p",[e._v("My main motivation to build this is for my own work as a teacher, and I do not have time to provide support. I built this in less than 10 hours, mostly to make my own life in handling grades easier. If you want to discuss something, you contact me, or even "),n("a",{attrs:{href:"https://github.com/pcbouman-eur/ese-grade-handler/issues",target:"blank"}},[e._v(" raise an issue on Github")]),e._v(". However, I do not make any promises I can do something about it. I also do not have to give basic user support, and I hope the tool is mostly self-explanatory so that it is not needed.")]),n("p",[e._v("Some other schools have dedicated programmers whose main task is to build this kind of software that saves researchers and teachers valuable time. The fastest way to get the features you want might be to find a developer who can contribute the feature you need to this project, or who writes a separate tool. This an MIT-licensed open source tool, and useful contributions are welcome.")])])],1)],1)},i=[],l={name:"Welcome"},u=l,c=(n("a17a"),n("2877")),d=n("6544"),f=n.n(d),h=n("62ad"),v=n("a523"),p=n("0fd9"),m=Object(c["a"])(u,o,i,!1,null,"40722623",null),y=m.exports;f()(m,{VCol:h["a"],VContainer:v["a"],VRow:p["a"]});var b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("h2",[e._v("Combine Results")]),n("p",[e._v("Combine student results from different input datasets into a single output dataset. You can toggle whether the students from a dataset should be added to the output. If you have a file with results from last year, you can disable adding students from last year to the set of output students. In that case, the results from last year's students are only included if their identities also appear in a dataset from this year (where the toggle is active). ")])])],1),n("v-row",[n("v-col",{attrs:{cols:"6"}},[n("h4",[e._v("Input Spreadsheets")]),n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpen}},[e._v("Add Spreadsheet")]),n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpenCanvas}},[e._v("Add Canvas Grades")]),n("input",{ref:"openFileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx,.csv"},on:{change:e.fileChosen}}),n("input",{ref:"openCanvasInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".csv"},on:{change:e.canvasFileChosen}}),n("br"),e._l(e.workbooks,(function(t){return n("div",{key:t.filename},[n("h3",[e._v(e._s(t.filename))]),e._l(t.frames,(function(t){return n("v-card",{key:t.sheetName},[n("v-card-title",[e._v(e._s(t.sheetName))]),n("v-card-actions",[n("v-switch",{attrs:{label:"Add all students to output"},model:{value:t.includeStudents,callback:function(n){e.$set(t,"includeStudents",n)},expression:"frame.includeStudents"}})],1)],1)})),t.skipped.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" "+e._s(t.skipped.length)+" sheets were skipped ")]):e._e()],2)})),n("AttendancePanel",{model:{value:e.attendance,callback:function(t){e.attendance=t},expression:"attendance"}})],2),n("v-col",{attrs:{cols:"6"}},[n("h4",[e._v("Output Spreadsheet")]),n("v-btn",{attrs:{color:"primary",disabled:0==e.availableKeys.length},on:{click:e.addOutputCol}},[e._v("Add Output Column")]),e._v(" "),n("v-btn",{attrs:{color:"primary",disabled:e.cantExport},on:{click:e.exportSheet}},[e._v("Export Spreadsheet")]),n("br"),n("v-switch",{attrs:{label:"Remove students without any results"},model:{value:e.dropEmptyStudents,callback:function(t){e.dropEmptyStudents=t},expression:"dropEmptyStudents"}}),this.availableKeys.length>0?n("div",[n("h4",[e._v("Key Column")]),n("v-select",{attrs:{items:e.availableKeys,label:"Key type",outlined:"",dense:""},model:{value:e.keyColumn,callback:function(t){e.keyColumn=t},expression:"keyColumn"}})],1):e._e(),e._l(e.outputColumns,(function(t,a){return n("div",{key:"output-"+a},[n("h4",[e._v("Output Column "+e._s(a+1))]),n("v-container",{staticClass:"dense"},[n("v-row",[n("v-col",{staticClass:"dense",attrs:{cols:"6"}},[n("SelectColumn",{attrs:{label:"Source Column",availableColumns:e.availableColumns,availableKeys:e.availableKeys},model:{value:e.outputColumns[a],callback:function(t){e.$set(e.outputColumns,a,t)},expression:"outputColumns[idx]"}})],1),n("v-col",{staticClass:"dense",attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:"Output Column Name",outlined:"",dense:""},model:{value:t.outputName,callback:function(n){e.$set(t,"outputName",n)},expression:"col.outputName"}})],1)],1)],1)],1)})),this.availableColumns.length>0?n("div",[n("h4",[e._v("Filter Students")]),n("v-switch",{attrs:{label:e.filterLabel},model:{value:e.addFilter,callback:function(t){e.addFilter=t},expression:"addFilter"}}),n("ConditionPanel",{directives:[{name:"show",rawName:"v-show",value:e.addFilter,expression:"addFilter"}],attrs:{availableColumns:e.availableColumns,availableKeys:e.availableKeys},on:{input:e.updateFilter}})],1):e._e()],2)],1)],1)},g=[],w=(n("4160"),n("a630"),n("b0c0"),n("d3b7"),n("07ac"),n("6062"),n("3ca3"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e7"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("159b"),n("ddb0"),n("b85c")),C=n("5530"),k=n("1146"),_=n.n(k),x=(n("b64b"),n("a1f0"),n("2ca0"),n("498a"),n("43dc"));function j(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=_.a.utils.decode_range(e["!ref"]),r=[],s=[],o=[],i=t-1;i<=a.e.r;++i)if(i==t-1)for(var l=a.s.c;l<=a.e.c;++l){var u=_.a.utils.encode_cell({c:l,r:t-1});if(e[u]){var c=e[u].v;c&&(r.push(c.trim()),o.push(l))}}else if(i>=n-1){var d,f=[],h=!1,v=Object(w["a"])(o);try{for(v.s();!(d=v.n()).done;){var p=d.value,m=_.a.utils.encode_cell({c:p,r:i});if(e[m]){var y=e[m].v;f.push(y),y&&(h=!0)}else f.push(null)}}catch(g){v.e(g)}finally{v.f()}h&&s.push(f)}var b=new x["DataFrame"](s,{columns:r});return b}var S=j,T=(n("caad"),n("2532"),{keyTypes:[{name:"erna",pattern:/\d{6}[a-z]{2}/g},{name:"student number",pattern:/\d{6}/g}],convert:function(e,t,n){if(e==t)return n;if("erna"==e&&"student number"==t)return n.substr(0,6);throw"Conversion from "+e+" to "+t+" not supported"},preferredType:function(e){var t,n=Object(w["a"])(this.keyTypes);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(e.includes(a.name))return a.name}}catch(r){n.e(r)}finally{n.f()}throw"No preferred type is available"},getPattern:function(e){var t,n=Object(w["a"])(this.keyTypes);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.name==e)return a.pattern}}catch(r){n.e(r)}finally{n.f()}}}),O=T;function R(e,t){var n,a=new Set,r=[],s=Object(w["a"])(e.data);try{for(s.s();!(n=s.n()).done;){var o=n.value,i=String(o),l=Array.from(i.matchAll(t.pattern));if(1!=l.length)return{result:!1,error:'No match for value "'+i+'"'};var u=l[0][0];if(a.has(u))return{result:!1,error:'Multiple occurences of "'+i+'"'};a.add(u),r.push(u)}}catch(c){s.e(c)}finally{s.f()}return{result:!0,keyCol:r}}function V(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O,a={},r=Object(w["a"])(e.columns);try{e:for(r.s();!(t=r.n()).done;){var s,o=t.value,i=Object(w["a"])(n.keyTypes);try{for(i.s();!(s=i.n()).done;){var l=s.value,u=R(e[o],l);if(u.result&&!(u.name in a)){a[l.name]={type:l.name,column:o,keys:u.keyCol};continue e}}}catch(c){i.e(c)}finally{i.f()}}}catch(c){r.e(c)}finally{r.f()}return a}function A(e){var t,n=[],a=[],r=Object(w["a"])(e.SheetNames);try{for(r.s();!(t=r.n()).done;){var s=t.value,o="No suitable key column found";try{var i=S(e.Sheets[s]),l=V(i);Object.keys(l).length>0&&(n.push({sheetName:s,df:i,keys:l}),o=void 0)}catch(u){o="Sheet has invalid structure"}o&&a.push({sheetName:s,error:o})}}catch(u){r.e(u)}finally{r.f()}return{frames:n,skipped:a}}var F="SIS User ID";function I(e){var t=[],n=[];if(e.SheetNames&&1==e.SheetNames.length){var a="No suitable key column found";try{var r=S(e.Sheets[e.SheetNames[0]],1,3);r.query({column:F,is:">",to:"",inplace:!0});var s=V(r);Object.keys(s).length>0&&(t.push({sheetName:"Canvas Grades",df:r,keys:s}),a=void 0)}catch(o){console.log(o),a="Sheet has invalid structure"}a&&n.push({sheetName:"Canvas Grades",error:a})}else n.push({sheetName:"All",error:"Unexpected structure in sheet"});return{frames:t,skipped:n}}var N="User",E="Attendance",P="Vrijstelling",M="Sessie",B=6,K=.7;function D(e){var t=e.Sheets[E];if(!t)return{error:"No sheet found with key "+E};var n=S(t,B,B+1),a=n[N].data;if(!a)return{error:"A column with name "+N+" was expected but not found."};var r=n[P].data;if(!r)return{error:"A column with name "+P+" was expected but not found."};var s,o=[],i={},l=Object(w["a"])(n.columns);try{for(l.s();!(s=l.n()).done;){var u=s.value;u.startsWith(M)&&(o.push(u),i[u]=n[u].data)}}catch(R){l.e(R)}finally{l.f()}var c,d={},f=[],h=Object(w["a"])(n.index);try{for(h.s();!(c=h.n()).done;){var v,p=c.value,m=a[p],y=r[p],b=new Set,g=Object(w["a"])(o);try{for(g.s();!(v=g.n()).done;){var C=v.value,k=i[C][p];k&&b.add(C)}}catch(R){g.e(R)}finally{g.f()}if(d[m]){f.push(m);var _=d[m];y=y||_.exemption;var x,j=Object(w["a"])(_.sessionsPresent);try{for(j.s();!(x=j.n()).done;){var T=x.value;b.add(T)}}catch(R){j.e(R)}finally{j.f()}}d[m]={userName:m,exemption:y,sessionsPresent:b}}}catch(R){h.e(R)}finally{h.f()}var O=Math.ceil(K*o.length);return{sessions:o,data:d,duplicates:f,threshold:O}}n("d81d");function G(e,t,n){if(console.log(e),"df"==e.type){var a=e.frame.keys[t].keys,r=e.frame.df[e.column].data,s={};return a.forEach((function(e,t){s[e]=r[t]})),s}if("attendance-cat"==e.type){var o,i={},l=e.data.threshold,u=Object(w["a"])(n);try{for(u.s();!(o=u.n()).done;){var c=o.value,d=e.data.data[c];i[c]="NO DATA",d&&(d.exemption?i[c]="EXEMPTION":d.sessionsPresent.size>=l?i[c]="PASS":i[c]="FAIL")}}catch(x){u.e(x)}finally{u.f()}return i}if("attendance-bool"==e.type){var f,h={},v=e.data.threshold,p=Object(w["a"])(n);try{for(p.s();!(f=p.n()).done;){var m=f.value;h[m]=0;var y=e.data.data[m];y&&(y.exemption||y.sessionsPresent.size>=v)&&(h[m]=1)}}catch(x){p.e(x)}finally{p.f()}return h}if("attendance-count"==e.type){var b,g={},C=Object(w["a"])(n);try{for(C.s();!(b=C.n()).done;){var k=b.value,_=e.data.data[k];_&&_.sessionsPresent&&(g[k]=_.sessionsPresent.size)}}catch(x){C.e(x)}finally{C.f()}return g}return{}}function U(e,t,n){if(!n)return function(){return!0};var a=G(n.lhs.data,e,t),r=function(){return null};if("column"==n.cmp.cmpType){var s=G(n.rhs.data,e,t);r=function(e){return s[e]}}"value"==n.cmp.cmpType&&(r=function(){return n.rhs});var o,i=new Set,l=Object(w["a"])(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=a[u],d=r(u);n.cmp.comparison(c,d)&&i.add(u)}}catch(f){l.e(f)}finally{l.f()}return function(e){return i.has(e)}}function $(e,t,n,a,r){var s,o=n.map((function(n){return G(n.data,e,t)})),i=U(e,t,r),l=[e],u=Object(w["a"])(n);try{for(u.s();!(s=u.n()).done;){var c=s.value;l.push(c.name)}}catch(k){u.e(k)}finally{u.f()}var d,f=[l],h=Object(w["a"])(t);try{for(h.s();!(d=h.n()).done;){var v=d.value;if(i(v)){var p,m=[v],y=!0,b=Object(w["a"])(o);try{for(b.s();!(p=b.n()).done;){var g=p.value,C=g[v];C||0===C||!1===C?(m.push(C),y=!1):m.push(null)}}catch(k){b.e(k)}finally{b.f()}y&&a||f.push(m)}}}catch(k){h.e(k)}finally{h.f()}return f}var W={makeTable:$,columnToDataset:G},L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"margin-top":"1em"}},[n("v-btn",{attrs:{color:"primary"},on:{click:e.clickAttOpen}},[e._v("Select Attendance Spreadsheet")]),n("input",{ref:"openAttFileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".xls"},on:{change:e.attFileChosen}}),n("br"),e.value?n("v-card",[n("v-card-title",[e._v("Attendance data")]),n("v-card-text",[n("h5",[e._v("Attendance data loaded for "+e._s(e.attendanceCount)+" students. "+e._s(e.value.sessions.length)+" sessions were found. ")]),n("v-list-item",[n("v-list-item-content",[n("v-text-field",{attrs:{type:"number",min:"0",max:e.value.sessions.length,label:"Minimum attendance threshold"},model:{value:e.value.threshold,callback:function(t){e.$set(e.value,"threshold",e._n(t))},expression:"value.threshold"}})],1)],1),e.value.duplicates.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" Multiple entries were found for the following students whose data was merged: "+e._s(e.value.duplicates.join(", "))+" ")]):e._e()],1)],1):e._e()],1)},z=[],H={name:"AttendancePanel",props:["value"],methods:{clickAttOpen:function(){this.$refs.openAttFileInput.click()},attFileChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var n=new Uint8Array(e.target.result),a=_.a.read(n,{type:"array"}),r=D(a);t.$emit("input",r)},a.readAsArrayBuffer(n)}}},computed:{attendanceCount:function(){return this.value&&this.value.data?Object.keys(this.value.data).length:0}}},q=H,J=(n("0b00"),n("0798")),Y=n("8336"),X=n("b0af"),Q=n("99d9"),Z=n("da13"),ee=n("5d23"),te=n("8654"),ne=Object(c["a"])(q,L,z,!1,null,"e2bdd84e",null),ae=ne.exports;f()(ne,{VAlert:J["a"],VBtn:Y["a"],VCard:X["a"],VCardText:Q["c"],VCardTitle:Q["d"],VListItem:Z["a"],VListItemContent:ee["a"],VTextField:te["a"]});var re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.value?n("v-select",{attrs:{items:e.availableColumns,"item-text":e.availableColumnToText,"item-value":e.availableColumnToValue,value:e.currentCol.outputColumn,label:e.label,outlined:"",dense:""},on:{change:function(t){return e.updateSourceColumn(t,e.currentCol)}}}):e._e()},se=[],oe={name:"SelectColumn",props:["availableColumns","availableKeys","value","label","index"],methods:{availableColumnToText:function(e){return"attendance-cat"==e.type?"Attendance Status":"attendance-bool"==e.type?"Attendance Passed":"attendance-count"==e.type?"Attendance Count":"df"==e.type?e.wb&&e.wb.filename?e.wb.filename+" / "+e.frame.sheetName+" / "+e.column:e.frame&&e.frame.sheetName&&e.column?"Unknown Workbook / "+e.frame.sheetName+" / "+e.column:e.column?"Unknown Workbook / Unknown Sheet / "+e.column:"[ERROR - Unknown Column]":"[ERROR - Unknown Column Type]"},availableColumnToValue:function(e){return{index:e.index,column:e.column}},updateSourceColumn:function(e,t){t.outputColumn=e,t.outputName=e.column,this.$emit("input",t)}},computed:{currentCol:function(){return this.value}}},ie=oe,le=(n("0b9b"),n("b974")),ue=Object(c["a"])(ie,re,se,!1,null,"5c14aff6",null),ce=ue.exports;f()(ue,{VSelect:le["a"]});var de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",[n("v-card-text",[e.availableColumns.length>0?n("v-container",{attrs:{dense:""}},[n("v-row",{attrs:{dense:""}},[n("v-col",{staticClass:"extra-dense",attrs:{cols:"12"}},[n("SelectColumn",{attrs:{label:"Column",availableColumns:e.availableColumns,availableKeys:e.availableKeys},on:{input:e.updateLhsCol},model:{value:e.filterCol,callback:function(t){e.filterCol=t},expression:"filterCol"}})],1)],1),n("v-row",{attrs:{dense:""}},[n("v-col",{staticClass:"extra-dense",attrs:{cols:"4"}},[n("v-select",{attrs:{items:e.ConditionOptions,"item-text":function(e){return e.label+" ("+e.cmpType+")"},"item-value":function(e){return e},label:"Comparison Type",outlined:"",dense:""},on:{change:e.updateResult},model:{value:e.cmpType,callback:function(t){e.cmpType=t},expression:"cmpType"}})],1),n("v-col",{staticClass:"extra-dense",attrs:{cols:"8"}},[e.showRhsValue?n("v-text-field",{attrs:{label:"Value",outlined:"",dense:""},on:{input:e.updateResult},model:{value:e.rhsValue,callback:function(t){e.rhsValue=t},expression:"rhsValue"}}):e._e(),e.showRhsColumn?n("SelectColumn",{attrs:{label:"Column",availableColumns:e.availableColumns,availableKeys:e.availableKeys},on:{input:e.updateRhsCol},model:{value:e.rhsCol,callback:function(t){e.rhsCol=t},expression:"rhsCol"}}):e._e()],1)],1)],1):e._e()],1)],1)},fe=[],he=[{label:"<",cmpType:"column",comparison:function(e,t){return e<t}},{label:"≤",cmpType:"column",comparison:function(e,t){return e<=t}},{label:"=",cmpType:"column",comparison:function(e,t){return e==t}},{label:"≠",cmpType:"column",comparison:function(e,t){return e!=t}},{label:"≥",cmpType:"column",comparison:function(e,t){return e>=t}},{label:">",cmpType:"column",comparison:function(e,t){return e>t}},{label:"<",cmpType:"value",comparison:function(e,t){return e<t}},{label:"≤",cmpType:"value",comparison:function(e,t){return e<=t}},{label:"=",cmpType:"value",comparison:function(e,t){return e==t}},{label:"≠",cmpType:"value",comparison:function(e,t){return e!=t}},{label:"≥",cmpType:"value",comparison:function(e,t){return e>=t}},{label:">",cmpType:"value",comparison:function(e,t){return e>t}},{label:"is a truthy value",cmpType:"unary",comparison:function(e){return e}},{label:"is a falsy value",cmpType:"unary",comparison:function(e){return!e}}],ve=he,pe={name:"ConditionPanel",components:{SelectColumn:ce},props:["availableColumns","availableKeys"],data:function(){return{filterCol:null,rhsCol:null,rhsValue:"",ConditionOptions:ve,cmpType:ve[0]}},created:function(){this.init()},methods:{updateLhsCol:function(e){this.filterColIdx=e.index,this.updateResult()},updateRhsCol:function(e){this.rhsColIdx=e.index,this.updateResult()},updateResult:function(){if(this.filterCol){var e=this.availableColumns[this.filterCol.outputColumn.index],t={lhs:{name:e.outputName,data:e},cmp:this.cmpType};if(this.showRhsValue&&(t.rhs=this.rhsValue),this.showRhsColumn){var n=this.availableColumns[this.rhsCol.outputColumn.index];t.rhs={name:n.outputName,data:n}}this.$emit("input",t)}},init:function(){this.filterCol||(this.filterCol={outputKey:this.availableKeys[0],outputColumn:this.availableColumns[0],outputName:this.availableColumns[0].column},this.rhsCol={outputKey:this.availableKeys[0],outputColumn:this.availableColumns[0],outputName:this.availableColumns[0].column},this.updateResult())}},computed:{showRhsValue:function(){return"value"==this.cmpType.cmpType},showRhsColumn:function(){return"column"==this.cmpType.cmpType}},watch:{availableColumns:function(){this.init()}}},me=pe,ye=(n("655c"),Object(c["a"])(me,de,fe,!1,null,"ff8925b2",null)),be=ye.exports;f()(ye,{VCard:X["a"],VCardText:Q["c"],VCol:h["a"],VContainer:v["a"],VRow:p["a"],VSelect:le["a"],VTextField:te["a"]});var ge={name:"Combiner",components:{AttendancePanel:ae,SelectColumn:ce,ConditionPanel:be},data:function(){return{workbooks:[],keyColumn:void 0,outputColumns:[],dropEmptyStudents:!0,attendance:null,addFilter:!1,currentFilter:{}}},methods:{clickOpen:function(){this.$refs.openFileInput.click()},clickOpenCanvas:function(){this.$refs.openCanvasInput.click()},fileChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),r=_.a.read(a,{type:"array"}),s=A(r),o=Object(C["a"])({filename:n.name,workbook:r},s);o.frames.forEach((function(e){return e.includeStudents=!0})),t.workbooks.push(o)},a.readAsArrayBuffer(n)}},canvasFileChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),r=_.a.read(a,{type:"array"}),s=I(r),o=Object(C["a"])({filename:n.name,workbook:r},s);o.frames.forEach((function(e){return e.includeStudents=!0})),t.workbooks.push(o)},a.readAsArrayBuffer(n)}},addOutputCol:function(){this.outputColumns.push({outputKey:this.availableKeys[0],outputColumn:this.availableColumns[0],outputName:this.availableColumns[0].column})},exportSheet:function(){var e=W.makeTable(this.keyColumn,this.allKeys,this.selectedColumns,this.dropEmptyStudents,this.activeFilter),t=_.a.utils.book_new(),n=_.a.utils.aoa_to_sheet(e);_.a.utils.book_append_sheet(t,n,"Output"),_.a.writeFile(t,"output.xlsx")},updateFilter:function(e){this.currentFilter=e}},computed:{activeFilter:function(){return this.addFilter?this.currentFilter:null},availableColumns:function(){var e,t=[],n=0,a=Object(w["a"])(this.workbooks);try{for(a.s();!(e=a.n()).done;){var r,s=e.value,o=Object(w["a"])(s.frames);try{for(o.s();!(r=o.n()).done;){var i,l=r.value,u=Object(w["a"])(l.df.columns);try{for(u.s();!(i=u.n()).done;){var c=i.value;t.push({type:"df",wb:s,frame:l,column:c,index:n++})}}catch(d){u.e(d)}finally{u.f()}}}catch(d){o.e(d)}finally{o.f()}}}catch(d){a.e(d)}finally{a.f()}return this.attendance&&(t.push({type:"attendance-bool",column:"Attendance",index:n++,data:this.attendance}),t.push({type:"attendance-cat",column:"Attendance Status",index:n++,data:this.attendance}),t.push({type:"attendance-count",column:"Attendance Count",index:n++,data:this.attendance})),t},availableKeys:function(){var e,t=new Set,n=Object(w["a"])(this.workbooks);try{for(n.s();!(e=n.n()).done;){var a,r=e.value,s=Object(w["a"])(r.frames);try{for(s.s();!(a=s.n()).done;)for(var o=a.value,i=0,l=Object.values(o.keys);i<l.length;i++){var u=l[i];t.add(u.type)}}catch(c){s.e(c)}finally{s.f()}}}catch(c){n.e(c)}finally{n.f()}return Array.from(t).sort()},allKeys:function(){var e,t=new Set,n=Object(w["a"])(this.workbooks);try{for(n.s();!(e=n.n()).done;){var a,r=e.value,s=Object(w["a"])(r.frames);try{for(s.s();!(a=s.n()).done;){var o=a.value;if(o.includeStudents&&this.keyColumn&&o.keys[this.keyColumn]){var i,l=o.keys[this.keyColumn],u=Object(w["a"])(l.keys);try{for(u.s();!(i=u.n()).done;){var c=i.value;t.add(c)}}catch(d){u.e(d)}finally{u.f()}}}}catch(d){s.e(d)}finally{s.f()}}}catch(d){n.e(d)}finally{n.f()}return t=Array.from(t).sort(),t},selectedColumns:function(){var e,t=[],n=Object(w["a"])(this.outputColumns);try{for(n.s();!(e=n.n()).done;){var a=e.value,r=a.outputColumn.index,s=this.availableColumns[r],o=a.outputName;t.push({name:o,data:s})}}catch(i){n.e(i)}finally{n.f()}return t},cantExport:function(){return!this.keyColumn||0==this.outputColumns.length},filterLabel:function(){return this.addFilter?"Only students where the following condition holds are included:":"All students are included"}},watch:{availableKeys:function(){!this.keyColumn&&this.availableKeys.length>0&&(this.keyColumn=this.availableKeys[0])}}},we=ge,Ce=(n("f836"),n("b73d")),ke=Object(c["a"])(we,b,g,!1,null,"326983c4",null),_e=ke.exports;f()(ke,{VAlert:J["a"],VBtn:Y["a"],VCard:X["a"],VCardActions:Q["a"],VCardTitle:Q["d"],VCol:h["a"],VContainer:v["a"],VRow:p["a"],VSelect:le["a"],VSwitch:Ce["a"],VTextField:te["a"]});var xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("h2",[e._v("Inject Results")]),n("p",[e._v("Read final course results from one dataset and inject those results into the official SPD spreadsheet to be loaded into Osiris. The free version of SheetJS strips the styling and layout from the output spreadsheet. I am not sure if that is a problem for SPD, but it is easy to copy paste the results in the official sheet to work around this. ")]),n("p",[n("strong",[e._v("Note:")]),e._v(" attendance data is not required; if you don't have mandatory attendance, you can just skip adding the attendance spreadsheet. ")])])],1),n("v-row",[n("v-col",{attrs:{cols:"6"}},[n("h4",[e._v("Input Spreadsheets (Course Results)")]),n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpen}},[e._v("Select Source Spreadsheet")]),n("input",{ref:"openFileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.fileChosen}}),n("br"),e.sourceBook?n("v-card",[n("v-card-title",[e._v(e._s(e.sourceBook.filename))]),n("v-card-text",[n("h5",[e._v("The following sheets were found")]),e._l(e.sourceBook.frames,(function(t){return n("v-list-item",{key:t.sheetName},[n("v-list-item-content",[e._v(e._s(t.sheetName))])],1)})),e.sourceBook.skipped.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" "+e._s(e.sourceBook.skipped.length)+" sheets were skipped ")]):e._e()],2)],1):e._e(),n("AttendancePanel",{model:{value:e.attendance,callback:function(t){e.attendance=t},expression:"attendance"}})],1),n("v-col",{attrs:{cols:"6"}},[n("h4",[e._v("Target Spreadsheet (as provided by SPD)")]),n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpenTarget}},[e._v("Set Target Spreadsheet")]),e._v(" "),n("v-btn",{attrs:{color:"primary",disabled:!e.injectionResults},on:{click:e.downloadResult}},[e._v(" Export Results")]),e._v(" "),n("v-btn",{attrs:{color:"primary",disabled:!e.injectionResults||0==e.injectionResults.missing.length},on:{click:e.downloadMissing}},[e._v(" Export Missing")]),n("input",{ref:"openFileTarget",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.fileTargetChosen}}),e.attendance?n("v-switch",{attrs:{label:"Invalid result for students with insufficient attendance"},model:{value:e.useAttendance,callback:function(t){e.useAttendance=t},expression:"useAttendance"}}):e._e(),e.targetFilename?n("h5",[e._v("Target Spreadsheet: "+e._s(e.targetFilename))]):n("h5",[e._v("Target Spreadsheet: not set")]),n("v-select",{staticClass:"margin-top",attrs:{disabled:0==e.availableColumns.length,items:e.availableColumns,"item-text":e.availableColumnToText,"item-value":e.availableColumnToValue,label:"Source Column",outlined:""},model:{value:e.sourceColumn,callback:function(t){e.sourceColumn=t},expression:"sourceColumn"}}),e.injectionResults&&e.injectionResults.missing.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" There are "+e._s(e.injectionResults.missing.length)+" students who were missing in the injection target. ")]):e._e(),e.injectionResults&&e.injectionResults.errors.length>0?[n("br"),n("v-alert",{attrs:{type:"error"}},[e._v(" There were "+e._s(e.injectionResults.errors.length)+" errors while injecting results. ")]),n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v(" View Errors ")]),n("v-expansion-panel-content",[n("ul",e._l(e.injectionResults.errors,(function(t,a){return n("li",{key:"error-"+a},[e._v(" "+e._s(t)+" ")])})),0)])],1)],1)]:e._e(),e.injectionResults&&e.injectionResults.warnings.length>0?[n("br"),n("v-alert",{attrs:{type:"warning"}},[e._v(" There were "+e._s(e.injectionResults.warnings.length)+" warnings while injecting results. ")]),n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v(" View Warnings ")]),n("v-expansion-panel-content",[n("ul",e._l(e.injectionResults.warnings,(function(t,a){return n("li",{key:"warning-"+a},[e._v(" "+e._s(t)+" ")])})),0)])],1)],1)]:e._e()],2)],1)],1)},je=[],Se=(n("ac1f"),n("5319"),n("a9e3"),n("9129"),n("b680"),1e-7),Te={alternatives:["VD","NVD","VR","GGR","ONV","NO","FR"],missingValue:"NO",invalidResult:"GGR",minGrade:1,maxGrade:10,roundingRule:function(e){return Math.floor(Se+10*e)/10},truncateRule:function(e){return Math.max(this.minGrade,Math.min(this.maxGrade,e))},finalize:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.alternatives.includes(e))return e;if(t)return"GGR";var n=parseFloat(e);return n=this.roundingRule(n),n=this.truncateRule(n),n.toFixed(1)},checkError:function(e){if(this.alternatives.includes(e))return!1;try{var t=parseFloat(e);return!!Number.isNaN(t)&&"Value "+e+" is not a valid result"}catch(n){return n.message}},checkWarning:function(e){if(this.alternatives.includes(e))return!1;var t=parseFloat(e);return t<this.minGrade?"Grade can not be smaller than "+this.minGrade+". Set to "+this.minGrade:t>this.maxGrade?"Grade can not be greater than "+this.maxGrade+". Set to "+this.maxGrade:void 0}},Oe=Te,Re=(n("4de4"),n("4fad"),n("3835")),Ve="Toetslijst",Ae="A8",Fe="Studentnummer",Ie=0,Ne="D8",Ee="Resultaat",Pe=3,Me=8,Be="erna",Ke="student number";function De(e,t,n,a,r,s){if(t){var o=r.checkError(t);if(o)return n.push("Error for student "+e+" : "+o),null;var i=r.checkWarning(t);return i?(a.push("Warning for student "+e+" : "+i),r.finalize(t)):r.finalize(t,s)}return a.push("Injected "+r.missingValue+" for student "+e+" since there was no data."),r.missingValue}function Ge(e){var t={};if(e)for(var n=0,a=Object.keys(e.data);n<a.length;n++){var r=a[n];t[r.substring(0,6)]=r}return t}function Ue(e,t,n){if(!e)return!1;var a=n[t];if(!a||!e.data[a])return!0;var r=e.data[a];return r.sessionsPresent.size<e.threshold}function $e(e,t,n,a){for(var r=W.columnToDataset(e,Be),s=Ge(a),o={},i=[],l=[],u=0,c=Object.entries(r);u<c.length;u++){var d=Object(Re["a"])(c[u],2),f=d[0],h=d[1],v=n.convert(Be,Ke,f),p=Ue(a,v,s),m=De(v,h,i,l,t,p);o[v]=m}return{data:o,errors:i,warnings:l}}function We(e,t){var n=e[Ae],a=e[Ne];return n&&n.v==Fe?!(!a||a.v!=Ee)||(t.push('Incorrect structure for target file. Value "'+Ee+'" was not found in Cell '+Ne),!1):(t.push('Incorrect structure for target file. Value "'+Fe+'" was not found in Cell '+Ae),!1)}function Le(e,t,n,a,r){var s=[],o=[],i=[],l=t.Sheets[Ve],u=Ge(r);if(l&&We(l,s)){for(var c=new Set,d=W.columnToDataset(e,Be),f={},h=0,v=Object.entries(d);h<v.length;h++){var p=Object(Re["a"])(v[h],2),m=p[0],y=p[1],b=a.convert(Be,Ke,m);f[b]=y}for(var g=_.a.utils.decode_range(l["!ref"]),w=Me;w<=g.e.r;w++){var C=_.a.utils.encode_cell({c:Ie,r:w}),k=_.a.utils.encode_cell({c:Pe,r:w}),x=l[C],j=l[k];j||(l[k]={t:"s",v:null},j=l[k]);var S=x.v,T=Ue(r,S,u);if(S){c.add(S);var O=f[S];j.v=De(S,O,s,o,n,T)}}for(var R=0,V=Object.entries(f);R<V.length;R++){var A=Object(Re["a"])(V[R],2),F=A[0],I=A[1],N=Ue(r,F,u);c.has(F)||i.push({id:F,result:De(F,I,s,o,n,N)})}}else s.push("Incorrect structure for target file. Sheet "+Ve+" was expected but not found");return{wb:t,errors:s,warnings:o,missing:i}}function ze(e,t){if(e.length)for(var n=_.a.utils.decode_range(t["!ref"]),a=e.filter((function(e){return e>=n.s.r&&e<=n.e.r})).sort((function(e,t){return e-t})),r=0,s=n.s.r;s<=n.e.r;s++)if(r<a.length&&s==a[r]){for(var o=n.s.c;o<=n.e.c;o++){var i=_.a.utils.encode_cell({c:o,r:s});t[i]&&delete t[i]}r++}else{if(0==r)continue;for(var l=n.s.c;l<=n.e.c;l++){var u=_.a.utils.encode_cell({c:l,r:s}),c=_.a.utils.encode_cell({c:l,r:s-r});t[u]&&(t[c]=t[u],delete t[u])}}}function He(e,t){var n=[],a=[],r=[],s=t.Sheets[Ve];if(s&&We(s,n)){for(var o=[],i=_.a.utils.decode_range(s["!ref"]),l=Me;l<=i.e.r;l++){var u=_.a.utils.encode_cell({c:Ie,r:l}),c=_.a.utils.encode_cell({c:Pe,r:l}),d=s[u],f=d.v;if(f&&e[f]){var h=e[f],v=s[c];v?v.v=h:s[c]={t:"s",v:h}}else o.push(l)}ze(o,s)}else n.push("Incorrect structure for target file. Sheet "+Ve+" was expected but not found");return{wb:t,errors:n,warnings:a,missing:r}}function qe(e){var t=[],n=[],a=[],r=e.Sheets[Ve],s={};if(r&&We(r,t))for(var o=_.a.utils.decode_range(r["!ref"]),i=Me;i<=o.e.r;i++){var l=_.a.utils.encode_cell({c:Ie,r:i}),u=_.a.utils.encode_cell({c:Pe,r:i}),c=r[l],d=r[u],f=c?c.v:void 0,h=d?d.v:void 0;f&&(h?s[f]={result:h,student:f,row:i}:n.push("Missing result for student "+f+" in row "+i))}else t.push("Incorrect structure for target file. Sheet "+Ve+" was expected but not found");return{entries:s,errors:t,warnings:n,missing:a}}var Je={name:"Injector",components:{AttendancePanel:ae},data:function(){return{attendance:null,useAttendance:!0,sourceBook:null,sourceColumn:null,rawTarget:null,targetFilename:null,dropEmptyStudents:!1}},methods:{clickOpen:function(){this.$refs.openFileInput.click()},clickOpenTarget:function(){this.$refs.openFileTarget.click()},fileChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),r=_.a.read(a,{type:"array"}),s=A(r),o=Object(C["a"])({filename:n.name,workbook:r},s);t.sourceBook=o},a.readAsArrayBuffer(n)}},fileTargetChosen:function(e){var t=this;if(e.target.files[0]){this.rawTarget=null,this.target=null;var n=e.target.files[0],a=new FileReader;a.onload=function(e){t.rawTarget=new Uint8Array(e.target.result),t.targetFilename=n.name},a.readAsArrayBuffer(n)}},availableColumnToText:function(e){return e.wb&&e.wb.filename?e.wb.filename+" / "+e.frame.sheetName+" / "+e.column:e.frame&&e.frame.sheetName&&e.column?"Unknown Workbook / "+e.frame.sheetName+" / "+e.column:e.column?"Unknown Workbook / Unknown Sheet / "+e.column:"[ERROR - Unknown Column]"},availableColumnToValue:function(e){return{index:e.index,column:e.column}},addOutputCol:function(){this.outputColumns.push({outputKey:this.availableKeys[0],outputColumn:this.availableColumns[0],outputName:this.availableColumns[0].column})},updateSourceColumn:function(e,t){t.outputColumn=e,t.outputName=e.column},downloadResult:function(){if(this.injectionResults&&this.injectionResults.wb){var e=this.targetFilename.replace(".xlsx","-injected.xlsx");_.a.writeFile(this.injectionResults.wb,e)}},downloadMissing:function(){if(this.injectionResults&&this.injectionResults.missing.length>0){var e,t=[["Student","Result"]],n=Object(w["a"])(this.injectionResults.missing);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.push([a.id,a.result])}}catch(i){n.e(i)}finally{n.f()}var r=this.targetFilename.replace(".xlsx","-missing.xlsx"),s=_.a.utils.book_new(),o=_.a.utils.aoa_to_sheet(t);_.a.utils.book_append_sheet(s,o,"Missing"),_.a.writeFile(s,r)}}},computed:{injectionResults:function(){if(this.rawTarget&&this.selectedColumn)try{var e=_.a.read(this.rawTarget,{type:"array",cellStyles:!0}),t=this.attendance&&this.useAttendance?this.attendance:null,n=Le(this.selectedColumn,e,Oe,O,t);return n}catch(a){return{errors:["Error while processing target spreadsheet: "+a.message]}}return null},availableColumns:function(){var e=[],t=0;if(this.sourceBook){var n,a=Object(w["a"])(this.sourceBook.frames);try{for(a.s();!(n=a.n()).done;){var r,s=n.value,o=Object(w["a"])(s.df.columns);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.push({wb:this.sourceBook,frame:s,column:i,index:t++,type:"df"})}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}}return e},allKeys:function(){var e=new Set;if(this.sourceBook){var t,n=Object(w["a"])(this.sourceBook.frames);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.includeStudents&&this.keyColumn&&a.keys[this.keyColumn]){var r,s=a.keys[this.keyColumn],o=Object(w["a"])(s.keys);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.add(i)}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){n.e(l)}finally{n.f()}}return e=Array.from(e).sort(),e},selectedColumn:function(){if(this.sourceColumn){var e=this.sourceColumn.index,t=this.availableColumns[e];return t}return null}}},Ye=Je,Xe=(n("a95d"),n("cd55")),Qe=n("49e2"),Ze=n("c865"),et=n("0393"),tt=Object(c["a"])(Ye,xe,je,!1,null,"035f3ff4",null),nt=tt.exports;f()(tt,{VAlert:J["a"],VBtn:Y["a"],VCard:X["a"],VCardText:Q["c"],VCardTitle:Q["d"],VCol:h["a"],VContainer:v["a"],VExpansionPanel:Xe["a"],VExpansionPanelContent:Qe["a"],VExpansionPanelHeader:Ze["a"],VExpansionPanels:et["a"],VListItem:Z["a"],VListItemContent:ee["a"],VRow:p["a"],VSelect:le["a"],VSwitch:Ce["a"]});var at=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",{attrs:{align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("h2",[e._v("Mutate Results")]),n("p",[e._v("If course results have been established, this workflow can compare the submitted grades to a spreadsheet with updated course results. The output is an SPD spreadsheet which only contains the results that have changed. If you already made mutations before, it is also possible to add some of these mutation spreadsheets submitted to SPD. This way, the output spreadsheet generated only contains the course results that must be mutated by SPD. ")])])],1),n("v-row",[n("v-col",{attrs:{cols:"6"}},[n("v-card",[n("v-card-title",[e._v("Input Spreadsheet: (Updated) Course Results")]),n("v-card-text",[n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpen}},[e._v("Select Source Spreadsheet")]),n("input",{ref:"openFileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.fileChosen}}),e._v(" "),n("AttendancePanel",{model:{value:e.attendance,callback:function(t){e.attendance=t},expression:"attendance"}})],1)],1),n("br"),e.sourceBook?n("v-card",[n("v-card-title",[e._v(e._s(e.sourceBook.filename))]),n("v-card-text",[n("h5",[e._v("The following sheets were found")]),e._l(e.sourceBook.frames,(function(t){return n("v-list-item",{key:t.sheetName},[n("v-list-item-content",[e._v(e._s(t.sheetName))])],1)})),e.sourceBook.skipped.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" "+e._s(e.sourceBook.skipped.length)+" sheets were skipped ")]):e._e()],2)],1):e._e(),n("v-card",[n("v-card-title",[e._v("Injection Target Spreadsheet (provided by/submitted to SPD)")]),n("v-card-text",[n("v-card",{attrs:{flat:""}},[e.targetData?n("v-card",{attrs:{flat:""}},[n("v-card-title",[e._v("Injection Target: "+e._s(e.targetData.name))]),n("v-card-subtitle",[e._v("Date: "+e._s(e.targetData.date)+", "),n("br"),e._v(" Entries: "+e._s(Object.keys(e.targetData.data.entries).length))])],1):n("v-alert",{attrs:{type:"warning"}},[e._v("Injection Target spreadsheet not set")])],1),e._l(e.mutations,(function(t,a){return[n("v-card",{key:"mut-"+a,attrs:{flat:""}},[n("v-card-title",[e._v("Mutation "+e._s(a+1)+" - "+e._s(t.name))]),n("v-card-subtitle",[e._v("Date: "+e._s(t.date)+", "),n("br"),e._v("Entries: "+e._s(Object.keys(t.data.entries).length))])],1)]}))],2),n("v-card-actions",[n("v-btn",{attrs:{color:"primary"},on:{click:e.clickOpenTarget}},[e._v("Set Target Spreadsheet")]),e._v(" "),n("v-btn",{attrs:{color:"primary"},on:{click:e.clickAddMutation}},[e._v("Add Mutations")])],1)],1),n("input",{ref:"addMutations",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.addMutationsChosen}})],1),n("v-col",{attrs:{cols:"6"}},[n("v-btn",{attrs:{color:"primary",disabled:!e.injectionResults},on:{click:e.downloadResult}},[e._v(" Export Results")]),e._v(" "),n("v-btn",{attrs:{color:"primary",disabled:!e.injectionResults||0==e.injectionResults.missing.length},on:{click:e.downloadMissing}},[e._v(" Export Missing")]),n("input",{ref:"openFileTarget",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.fileTargetChosen}}),e.attendance?n("v-switch",{attrs:{label:"Invalid result for students with insufficient attendance"},model:{value:e.useAttendance,callback:function(t){e.useAttendance=t},expression:"useAttendance"}}):e._e(),e.updatedResults?n("v-card",[n("v-card-text",[e._v(" "+e._s(e.updatedResults.data)+" ")])],1):e._e(),n("v-select",{staticClass:"margin-top",attrs:{disabled:0==e.availableColumns.length,items:e.availableColumns,"item-text":e.availableColumnToText,"item-value":e.availableColumnToValue,label:"Source Column",outlined:""},model:{value:e.sourceColumn,callback:function(t){e.sourceColumn=t},expression:"sourceColumn"}}),e.injectionResults&&e.injectionResults.missing.length>0?n("v-alert",{attrs:{type:"warning"}},[e._v(" There are "+e._s(e.injectionResults.missing.length)+" students who were missing in the injection target. ")]):e._e(),e.injectionResults&&e.injectionResults.errors.length>0?[n("br"),n("v-alert",{attrs:{type:"error"}},[e._v(" There were "+e._s(e.injectionResults.errors.length)+" errors while injecting results. ")]),n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v(" View Errors ")]),n("v-expansion-panel-content",[n("ul",e._l(e.injectionResults.errors,(function(t,a){return n("li",{key:"error-"+a},[e._v(" "+e._s(t)+" ")])})),0)])],1)],1)]:e._e(),e.injectionResults&&e.injectionResults.warnings.length>0?[n("br"),n("v-alert",{attrs:{type:"warning"}},[e._v(" There were "+e._s(e.injectionResults.warnings.length)+" warnings while injecting results. ")]),n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[e._v(" View Warnings ")]),n("v-expansion-panel-content",[n("ul",e._l(e.injectionResults.warnings,(function(t,a){return n("li",{key:"warning-"+a},[e._v(" "+e._s(t)+" ")])})),0)])],1)],1)]:e._e()],2)],1)],1)},rt=[],st={name:"Mutator",components:{AttendancePanel:ae},data:function(){return{attendance:null,useAttendance:!0,sourceBook:null,sourceColumn:null,rawTarget:null,targetData:null,mutations:[],dropEmptyStudents:!1}},methods:{clickOpen:function(){this.$refs.openFileInput.click()},clickOpenTarget:function(){this.$refs.openFileTarget.click()},clickAddMutation:function(){this.$refs.addMutations.click()},fileChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0],a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),r=_.a.read(a,{type:"array"}),s=A(r),o=Object(C["a"])({filename:n.name,workbook:r},s);t.sourceBook=o},a.readAsArrayBuffer(n)}},fileTargetChosen:function(e){var t=this;if(e.target.files[0]){this.rawTarget=null,this.target=null;var n=e.target.files[0],a=new FileReader;a.onload=function(e){t.rawTarget=new Uint8Array(e.target.result),t.targetFilename=n.name;var a=_.a.read(t.rawTarget,{type:"array"}),r=qe(a),s={name:n.name,lastModified:n.lastModified,date:new Date(n.lastModified),data:r};t.targetData=s},a.readAsArrayBuffer(n)}},addMutationsChosen:function(e){var t=this;if(e.target.files[0]){var n=e.target.files[0];console.log(n);var a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),r=_.a.read(a,{type:"array"}),s=qe(r),o={name:n.name,lastModified:n.lastModified,date:new Date(n.lastModified),data:s};t.mutations.push(o)},a.readAsArrayBuffer(n)}},availableColumnToText:function(e){return e.wb&&e.wb.filename?e.wb.filename+" / "+e.frame.sheetName+" / "+e.column:e.frame&&e.frame.sheetName&&e.column?"Unknown Workbook / "+e.frame.sheetName+" / "+e.column:e.column?"Unknown Workbook / Unknown Sheet / "+e.column:"[ERROR - Unknown Column]"},availableColumnToValue:function(e){return{index:e.index,column:e.column}},addOutputCol:function(){this.outputColumns.push({outputKey:this.availableKeys[0],outputColumn:this.availableColumns[0],outputName:this.availableColumns[0].column})},updateSourceColumn:function(e,t){t.outputColumn=e,t.outputName=e.column},downloadResult:function(){if(this.injectionResults&&this.injectionResults.wb){var e=this.targetFilename.replace(".xlsx","-injected.xlsx");_.a.writeFile(this.injectionResults.wb,e)}},downloadMissing:function(){if(this.injectionResults&&this.injectionResults.missing.length>0){var e,t=[["Student","Result"]],n=Object(w["a"])(this.injectionResults.missing);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.push([a.id,a.result])}}catch(i){n.e(i)}finally{n.f()}var r=this.targetFilename.replace(".xlsx","-missing.xlsx"),s=_.a.utils.book_new(),o=_.a.utils.aoa_to_sheet(t);_.a.utils.book_append_sheet(s,o,"Missing"),_.a.writeFile(s,r)}}},computed:{oldResults:function(){var e={};if(this.targetData){e=Object(C["a"])(Object(C["a"])({},e),this.targetData.data.entries),console.log(this.targetData);var t,n=Object(w["a"])(this.mutations);try{for(n.s();!(t=n.n()).done;){var a=t.value;console.log(a),e=Object(C["a"])(Object(C["a"])({},e),a.data.entries)}}catch(r){n.e(r)}finally{n.f()}}return e},updatedResults:function(){if(this.selectedColumn){var e=this.attendance&&this.useAttendance?this.attendance:null,t=$e(this.selectedColumn,Oe,O,e),n=t.data,a=new Set;Object.keys(n).forEach((function(e){return a.add(e)})),Object.keys(this.oldResults).forEach((function(e){return a.add(e)}));var r,s={},o=Object(w["a"])(a);try{for(o.s();!(r=o.n()).done;){var i=r.value,l=n[i],u=void 0===l||l==Oe.missingValue,c=this.oldResults[i],d=c?c.result:void 0,f=void 0===d||d==Oe.missingValue;if(d!=l){if(u&&f)continue;s[i]=u?Oe.missingValue:l}}}catch(h){o.e(h)}finally{o.f()}return s}return null},injectionResults:function(){if(this.rawTarget&&this.updatedResults)try{var e=_.a.read(this.rawTarget,{type:"array",cellStyles:!0}),t=He(this.updatedResults,e);return t}catch(n){return console.log(n),{errors:["Error while processing target spreadsheet: "+n.message]}}return null},availableColumns:function(){var e=[],t=0;if(this.sourceBook){var n,a=Object(w["a"])(this.sourceBook.frames);try{for(a.s();!(n=a.n()).done;){var r,s=n.value,o=Object(w["a"])(s.df.columns);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.push({wb:this.sourceBook,frame:s,column:i,index:t++,type:"df"})}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}}return e},allKeys:function(){var e=new Set;if(this.sourceBook){var t,n=Object(w["a"])(this.sourceBook.frames);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.includeStudents&&this.keyColumn&&a.keys[this.keyColumn]){var r,s=a.keys[this.keyColumn],o=Object(w["a"])(s.keys);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.add(i)}}catch(l){o.e(l)}finally{o.f()}}}}catch(l){n.e(l)}finally{n.f()}}return e=Array.from(e).sort(),e},selectedColumn:function(){if(this.sourceColumn){var e=this.sourceColumn.index,t=this.availableColumns[e];return t}return null}}},ot=st,it=(n("69ad"),Object(c["a"])(ot,at,rt,!1,null,"766418c1",null)),lt=it.exports;f()(it,{VAlert:J["a"],VBtn:Y["a"],VCard:X["a"],VCardActions:Q["a"],VCardSubtitle:Q["b"],VCardText:Q["c"],VCardTitle:Q["d"],VCol:h["a"],VContainer:v["a"],VExpansionPanel:Xe["a"],VExpansionPanelContent:Qe["a"],VExpansionPanelHeader:Ze["a"],VExpansionPanels:et["a"],VListItem:Z["a"],VListItemContent:ee["a"],VRow:p["a"],VSelect:le["a"],VSwitch:Ce["a"]});var ut={name:"App",components:{Combiner:_e,Injector:nt,Welcome:y,Mutator:lt},data:function(){return{currentTab:0}},methods:{refresh:function(){window.location.reload()}}},ct=ut,dt=n("7496"),ft=n("40dc"),ht=n("f6c4"),vt=n("2fa4"),pt=n("71a3"),mt=n("fe57"),yt=Object(c["a"])(ct,r,s,!1,null,null,null),bt=yt.exports;f()(yt,{VApp:dt["a"],VAppBar:ft["a"],VBtn:Y["a"],VMain:ht["a"],VSpacer:vt["a"],VTab:pt["a"],VTabs:mt["a"]});var gt=n("f309");a["a"].use(gt["a"]);var wt=new gt["a"]({});a["a"].config.productionTip=!1,new a["a"]({vuetify:wt,render:function(e){return e(bt)}}).$mount("#app")},"5e60":function(e,t,n){},6:function(e,t){},"655c":function(e,t,n){"use strict";n("2b92")},"69ad":function(e,t,n){"use strict";n("1387")},7:function(e,t){},8:function(e,t){},9:function(e,t){},a17a:function(e,t,n){"use strict";n("5e60")},a95d:function(e,t,n){"use strict";n("fca2")},e621:function(e,t,n){},f836:function(e,t,n){"use strict";n("0a80")},fca2:function(e,t,n){}});
//# sourceMappingURL=index.0059bb94.js.map